"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7014],{8302:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>o});var r=s(5893),i=s(1151);const t={sidebar_position:6},a="Les Handlers",l={id:"Ansible/Les Handlers",title:"Les Handlers",description:"Les handlers Ansible permettent de notifier et d'ex\xe9cuter des actions en fonction de l'\xe9tat d'une t\xe2che. Par exemple, si une t\xe2che provoque une modification, comme la modification d'une configuration Apache, alors vous red\xe9marrez le service concern\xe9.",source:"@site/docs/Ansible/Les Handlers.md",sourceDirName:"Ansible",slug:"/Ansible/Les Handlers",permalink:"/docs/Ansible/Les Handlers",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Cr\xe9ation d'un R\xf4le Ansible",permalink:"/docs/Ansible/Cr\xe9ation d'un R\xf4le Ansible"},next:{title:"Les Variables Ansible",permalink:"/docs/Ansible/Les Variables"}},c={},o=[{value:"Nginx avec Ansible et Handlers",id:"nginx-avec-ansible-et-handlers",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"les-handlers",children:"Les Handlers"}),"\n",(0,r.jsx)(n.p,{children:"Les handlers Ansible permettent de notifier et d'ex\xe9cuter des actions en fonction de l'\xe9tat d'une t\xe2che. Par exemple, si une t\xe2che provoque une modification, comme la modification d'une configuration Apache, alors vous red\xe9marrez le service concern\xe9."}),"\n",(0,r.jsxs)(n.p,{children:['Les handlers se d\xe9finissent au niveau d\'un r\xf4le dans un r\xe9pertoire nomm\xe9 "handlers" par convention. Le fichier principal ',(0,r.jsx)(n.code,{children:"main.yml"})," contient alors une liste de t\xe2ches Ansible identifi\xe9es par leur ",(0,r.jsx)(n.code,{children:"name"}),". Il s'agit g\xe9n\xe9ralement de t\xe2ches de red\xe9marrage de service, comme par exemple :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"---\r\n- name: restart apache\r\n  ansible.builtin.systemd_service:\r\n    name: apache2\r\n    state: restarted\n"})}),"\n",(0,r.jsxs)(n.p,{children:['L\'identifiant de cette t\xe2che "restart apache" doit ensuite \xeatre notifi\xe9 lors de la description de la t\xe2che dans ',(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"tasks/main.yml"})})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"---\r\n- name: copy security.conf\r\n  ansible.builtin.copy:\r\n    src: security.conf\r\n    dest: /etc/apache2/conf-available/security.conf\r\n  notify: restart apache\r\n\n"})}),"\n",(0,r.jsx)(n.p,{children:'C\'est la ligne notify qui d\xe9clenchera le handler nomm\xe9 "restart apache" uniquement si le fichier security.conf est modifi\xe9. Les notifications sont trait\xe9es \xe0 la fin de l\'ex\xe9cution du playbook de mani\xe8re optimis\xe9e. Par exemple, si deux actions n\xe9cessitent un red\xe9marrage d\'Apache, alors un seul handler "restart apache" sera ex\xe9cut\xe9.'}),"\n",(0,r.jsx)(n.h2,{id:"nginx-avec-ansible-et-handlers",children:"Nginx avec Ansible et Handlers"}),"\n",(0,r.jsx)(n.p,{children:"Voici un exemple concret d'utilisation des handlers avec Nginx dans Ansible :"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/ansible/playbooks/roles/nginx/tasks/main.yml :"})})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"---\r\n- name: Install Nginx\r\n  ansible.builtin.apt:\r\n    name: nginx\r\n    state: present\r\n    update_cache: yes\r\n\r\n- name: Copy statik web\r\n  ansible.builtin.copy:\r\n    src: docusaurus\r\n    dest: /var/www/html/\r\n  notify: restart nginx\r\n\r\n- name: Copy nginx setting\r\n  ansible.builtin.copy:\r\n    src: docusaurus-nginx-web\r\n    dest: /etc/nginx/sites-available/\r\n\r\n- name: Create symlink\r\n  ansible.builtin.file:\r\n    src: /etc/nginx/sites-available/docusaurus-nginx-web\r\n    dest: /etc/nginx/sites-enabled/default\r\n    state: link\r\n  notify: restart nginx\r\n\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"/ansible/playbooks/roles/nginx/handlers/main.yml :"})})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"---\r\n- name: restart nginx\r\n  ansible.builtin.systemd_service:\r\n    name: nginx\r\n    state: restarted\r\n    enabled: yes\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cet exemple montre comment utiliser les handlers pour red\xe9marrer le service Nginx lors de la modification de la configuration."}),"\n",(0,r.jsx)(n.p,{children:"N'oubliez pas d'ajuster les noms de fichiers et les chemins en fonction de votre configuration."})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>a});var r=s(7294);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);