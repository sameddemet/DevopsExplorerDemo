"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2329],{3028:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>t,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var r=n(5893),l=n(1151);const i={sidebar_position:8},a="Variables et Mariadb Challenge",o={id:"Ansible/Variables et Mariadb Challenge",title:"Variables et Mariadb Challenge",description:"Challenge :",source:"@site/docs/Ansible/Variables et Mariadb Challenge.md",sourceDirName:"Ansible",slug:"/Ansible/Variables et Mariadb Challenge",permalink:"/docs/Ansible/Variables et Mariadb Challenge",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Les Variables Ansible",permalink:"/docs/Ansible/Les Variables"},next:{title:"Ansible Templates",permalink:"/docs/Ansible/Ansible Templates"}},t={},c=[];function d(e){const s={code:"code",h1:"h1",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,l.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{id:"variables-et-mariadb-challenge",children:"Variables et Mariadb Challenge"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Challenge :"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Installer manuellement un nouveau container avec LXC nomm\xe9 \xab mysql \xbb."}),"\n",(0,r.jsx)(s.li,{children:"Ajouter le dans le fichier d\u2019inventaire de votre d\xe9p\xf4t Ansible."}),"\n",(0,r.jsx)(s.li,{children:"D\xe9ployer une recette qui installe un serveur MySQL."}),"\n",(0,r.jsxs)(s.li,{children:["Cr\xe9er un fichier ",(0,r.jsx)(s.code,{children:"mysql"})," dans ",(0,r.jsx)(s.code,{children:"etc/host_vars/"})," qui contient une variable avec un mot de passe, par exemple ",(0,r.jsx)(s.code,{children:"mysql_password"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["D\xe9ployer un compte utilisateur ",(0,r.jsx)(s.code,{children:"bob"})," avec des droits sur toutes les bases de donn\xe9es en utilisant le module ",(0,r.jsx)(s.code,{children:"mysql_user"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["D\xe9ployer une base de donn\xe9es ",(0,r.jsx)(s.code,{children:"eponges"})," en utilisant le module Ansible appropri\xe9."]}),"\n",(0,r.jsxs)(s.li,{children:["Modifier l\u2019utilisateur ",(0,r.jsx)(s.code,{children:"bob"})," pour qu\u2019il ne puisse acc\xe9der qu\u2019\xe0 la base de donn\xe9es ",(0,r.jsx)(s.code,{children:"eponges"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Solution :"})}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Nous avons cr\xe9\xe9 un nouveau container nomm\xe9 ",(0,r.jsx)(s.code,{children:"mysql"})," avec LXC, puis nous avons assur\xe9 l'acc\xe8s via SSH et avons modifi\xe9 le fichier ",(0,r.jsx)(s.code,{children:"etc/hosts"}),"."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'vim etc/hosts_vars/mysql\r\nmysql_password: "12345"\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Cr\xe9ation du fichier ",(0,r.jsx)(s.code,{children:"ansible/playbooks/mysql.yml"})," :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"---\r\n- name: deploy mysql\r\n  hosts: mysql\r\n  remote_user: root\r\n  roles:\r\n    - mysql\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Modification du fichier ",(0,r.jsx)(s.code,{children:"ansible/playbooks/roles/mysql/tasks/main.yml"})," :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"- name: Install Mysql\r\n  ansible.builtin.apt:\r\n    state: present\r\n    update_cache: yes\r\n    pkg:\r\n      - mysql-server\r\n      - python3-pymysql\r\n      - percona-toolkit\r\n\r\n- name: Create a new database with name 'eponges'\r\n  community.mysql.mysql_db:\r\n    name: eponges\r\n    state: present\r\n    login_unix_socket: /run/mysqld/mysqld.sock\r\n\r\n- name: Create user 'bob' with all database privileges\r\n  mysql_user:\r\n    name: bob\r\n    password: \"{{ mysql_password }}\"\r\n    priv: '*.*:ALL,GRANT'\r\n    state: present\r\n    login_unix_socket: /run/mysqld/mysqld.sock\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Fichier ",(0,r.jsx)(s.code,{children:".github/workflows/tp.yml"})," :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"name: Deploy Ansible Project\r\n\r\non:\r\n  push:\r\n    branches:\r\n      - master\r\n  workflow_dispatch:\r\n\r\njobs:\r\n  build:\r\n    runs-on: self-hosted\r\n    steps:\r\n      - name: Checkout Repository\r\n        uses: actions/checkout@v2\r\n\r\n      - name: copy ansible files to right place\r\n        run: |\r\n          mkdir -p /home/student/ansible\r\n          rsync -av --delete -P ansible/* /home/student/ansible\r\n\r\n      - name: Deploy Ansible Project\r\n        working-directory: /home/student/challenge-s08-e01-bis-sameddemet/ansible\r\n        run: |\r\n          ansible-playbook playbooks/mysql.yml\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Apr\xe8s les modifications, le ",(0,r.jsx)(s.code,{children:"git push"})," a cr\xe9\xe9 une base de donn\xe9es nomm\xe9e ",(0,r.jsx)(s.code,{children:"eponges"})," et un utilisateur nomm\xe9 ",(0,r.jsx)(s.code,{children:"bob"})," avec des droits sur toutes les bases de donn\xe9es."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Modification de l'utilisateur ",(0,r.jsx)(s.code,{children:"bob"})," pour qu'il n'ait acc\xe8s qu'\xe0 la base de donn\xe9es ",(0,r.jsx)(s.code,{children:"eponges"}),":\r\nModifier la ligne ",(0,r.jsx)(s.code,{children:"priv:"})," dans le fichier ",(0,r.jsx)(s.code,{children:"ansible/playbooks/roles/mysql/tasks/main.yml"})," comme suit :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"priv: 'eponges.*:ALL,GRANT'\n"})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["Utilisation de boucles avec ",(0,r.jsx)(s.strong,{children:"Ansible Loops"})," pour cr\xe9er plusieurs utilisateurs :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'- name: Modify user bob so that he can only access the eponges database\r\n  mysql_user:\r\n    name: "{{ item }}"\r\n    password: "{{ mysql_password }}"\r\n    priv: \'eponges.*:ALL,GRANT\'\r\n    state: present\r\n    login_unix_socket: /run/mysqld/mysqld.sock\r\n  loop: \r\n      - bob\r\n      - toto\r\n      - tata\r\n      - titi\n'})}),"\n",(0,r.jsxs)(s.p,{children:["Dans ",(0,r.jsx)(s.code,{children:"\u2026tasks/main.yml"}),", la partie ",(0,r.jsx)(s.code,{children:"loop"})," devrait ressembler \xe0 ceci :"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'- name: Modify user bob so that he can only access the eponges database\r\n  mysql_user:\r\n    name: "{{ item.name }}"\r\n    password: "{{ item.password }}"\r\n    priv: \'eponges.*:ALL,GRANT\'\r\n    state: "{{ item.state }}"\r\n    login_unix_socket: /run/mysqld/mysqld.sock\r\n  loop: "{{ user_list }}"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Modification des utilisateurs avec des mots de passe diff\xe9rents et suppression de certains utilisateurs :"})}),"\n",(0,r.jsx)(s.p,{children:"Afin d'assurer que chaque utilisateur a un mot de passe diff\xe9rent et de g\xe9rer la suppression de certains utilisateurs, nous avons effectu\xe9 les \xe9tapes suivantes :"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["Fichier ",(0,r.jsx)(s.code,{children:"ansible/host_vars/mysql"})," :"]})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'user_list:\r\n    - name: bob\r\n    password: "HBvp64I5OQaFHyjhjESRBwuly"\r\n    state: present\r\n    - name: toto\r\n    password: "QOHAAlSMpdjbFCGGikX5MfuQ9"\r\n    state: present\r\n    - name: tata\r\n    password: "xnETh7KY4yuBdPY4qqUaGSntZ"\r\n    state: present\r\n    - name: titi\r\n    password: "jj41FtubOgbR8FwBRPaFM1nYA"\r\n    state: absent\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["Fichier ",(0,r.jsx)(s.code,{children:"ansible/playbooks/roles/mysql/tasks/main.yml"})," :"]})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yml",children:'- name: Cr\xe9ation des utilisateurs avec acc\xe8s \xe0 la base de donn\xe9es eponges\r\n  mysql_user:\r\n    name: "{{ item.name }}"\r\n    password: "{{ item.password }}"\r\n    priv: \'eponges.*:ALL,GRANT\'\r\n    state: "{{ item.state }}"\r\n    login_unix_socket: /run/mysqld/mysqld.sock\r\n  loop: "{{ user_list }}"\n'})}),"\n",(0,r.jsx)(s.p,{children:"Ainsi, le challenge Ansible Mariadb a \xe9t\xe9 r\xe9solu avec succ\xe8s en suivant ces \xe9tapes. Vous pouvez personnaliser selon vos besoins."})]})}function u(e={}){const{wrapper:s}={...(0,l.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,s,n)=>{n.d(s,{Z:()=>o,a:()=>a});var r=n(7294);const l={},i=r.createContext(l);function a(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);